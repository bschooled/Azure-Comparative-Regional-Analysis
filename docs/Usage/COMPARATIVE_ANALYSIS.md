# Comparative Analysis Script

## Overview

The `comparative_analysis.sh` script generates human-readable, pretty-printed reports from the Azure service comparison JSON outputs. It analyzes provider and SKU availability across two regions and highlights differences.

## Usage

### Basic Report (stdout)
```bash
./comparative_analysis.sh output/westus2_vs_swedencentral_providers.json
```

### Save to File
```bash
./comparative_analysis.sh output/westus2_vs_swedencentral_providers.json output/analysis_report.txt
```

## Workflow

### Step 1: Run Service Comparison
Generate the provider and SKU comparison data:

```bash
./services_compare.sh --source-region westus2 --target-region swedencentral
```

This generates:
- `output/westus2_vs_swedencentral_providers.json` - Source of truth with full provider and SKU data
- `output/westus2_vs_swedencentral_providers.csv` - Derived CSV for spreadsheet analysis

### Step 2: Run Comparative Analysis
Generate the pretty-printed report:

```bash
./comparative_analysis.sh output/westus2_vs_swedencentral_providers.json
# or save to file
./comparative_analysis.sh output/westus2_vs_swedencentral_providers.json output/analysis.txt
```

## Report Sections

### 1. Summary Statistics
- Total providers available in both regions
- Provider status breakdown (Full Match, Extended, No SKUs, etc.)
- Overall availability percentage

### 2. Microsoft.Compute Analysis
- Total VM SKU counts in each region
- Difference in availability
- Family/version breakdown (when detailed SKU data is available)
- Shows which VM families are available in which regions

### 3. Microsoft.Storage Analysis
- Account type distribution (BlobStorage, FileStorage, BlockBlobStorage, etc.)
- Counts by region for each type
- Helps identify storage service parity

### 4. Providers with Notable Differences
- Top 15 providers with the most SKU differences
- Shows which providers favor each region
- Helps identify regional capability gaps

## Output Format

The report uses visual separators and structured formatting:
- **╔═══╗** - Major section headers
- **═══════** - Section dividers  
- **✓** - Full match indicator
- **⟶** - Source extended (has more)
- **⟵** - Target extended (has more)
- **≈** - Available but no SKUs exposed via API

## Data Source

The analysis reads from the JSON file generated by `services_compare.sh`. This JSON contains:
- Region names (captured at comparison time)
- SKU counts for each provider
- Full SKU details (when available)
- Comparison status (FULL_MATCH, SOURCE_EXTENDED, etc.)

## Integration Example

Complete workflow:
```bash
# Compare two regions
./services_compare.sh --source-region eastus --target-region westeurope

# Generate analysis report
./comparative_analysis.sh output/eastus_vs_westeurope_providers.json output/eastus_vs_westeurope_analysis.txt

# View the report
cat output/eastus_vs_westeurope_analysis.txt
```

## Notes

- When SKU details exceed jq command-line limits (>1000 SKUs), they are omitted from JSON but counts are preserved
- Full SKU lists are always available in the JSON file for custom analysis
- CSV contains high-level provider comparison for spreadsheet import
- The report focuses on actionable differences between regions
